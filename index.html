<!DOCTYPE html>
<html>
<head>
	<title>Event Registration Form</title>
	<meta charset="UTF-8"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script src="https://cdn.lordicon.com/bhenfmcm.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
	<!-- <link href="css/custom.css" rel="stylesheet" /> -->
	<style>
		body {
			display: flex;
			align-items: center;
			flex-direction: column;
			height: 100vh;
			background: url('/background.png'); 
			background-repeat: no-repeat;
			background-size: cover;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			direction: rtl;
			color: #8F6D56;
			margin: 0;
			justify-content: center;
		}
		.wrapper{
			width: 90%;
			display: flex;
			align-items: center;
			flex-direction: column;
			justify-content: center;
			height: 100%;
			gap: 5%;
		}
		.openning{
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
			gap: 30px;
		}
		h1{
			font-size: 90px;
			text-align: center;
			margin: 0;
		}
		p{
			text-align: center;
			font-size: 60px;
		}
		#date{
			margin-top: 0px;
		}
		#invitation{
			display: flex;
			width: 100%;
			align-items: center;
			flex-direction: column;
			gap: 50px;
		}
		.amountLabel{
			font-size: 50px;
			/* text-align: right; */
		}
		#amount{
			width: 30%;
			background-color: transparent;
			border: transparent;
			border-bottom: 1px solid #8F6D56;
			color: #8F6D56;
			font-size: 50px;
		}
		.layout{
			width: 73%;
			display: flex;
			align-items: center;
			justify-content: space-between;
		}
		.btn{
			width: 300px;
			height: 90px;
			font-size: 45px;
			border-radius: 40px;
			border: transparent;
		}
		.btn__comming{
			background-color: #cfe885;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}
		.btn__notComming{
			background-color: #ffba98;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}
		#location{
			font-size: 40px;
		}
		.map{
			display: flex;
			align-items: center;
		}
		#loader {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			width: 100%;
			background: rgba(0,0,0,0.75) url(images/loading2.gif) no-repeat center center;
			z-index: 10000;
		}
		.innerLoader{
			display: flex;
			align-items: center;
			justify-content: center;
			height: 100%;
		}
		.missing{
			border: 1px solid red !important;
		}
		iframe{
			pointer-events: none;
		}

	</style>
</head>
<body>
	<div class="wrapper">
	<div>
		<h1> שלום <span id="name"></span></h1>
	</div>
	<div class="openning">
		<p> נשמח לאישור הגעתך לחתונה של<br/> תמר וגלי </p>
		<p id="date"><b> בתאריך 22-6-23</b></p>
	</div>
	<form action="thanku.html" id="invitation">
		<div class="layout">
			<label class="amountLabel" for="amount">כמה תהיו?</label>
			<select id="amount">
				<option selected>0</option>
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
				<option>7</option>
				<option>8</option>
			</select>
		</div>

		<div class="layout">
			<button name="coming" type="submit" class="btn btn__comming">מגיעים</button>
			<button name="notComing" type="submit" class="btn btn__notComming">לא מגיעים</button>
		</div>
	</form>
		<div>
			<p id="location">אהובת הספן, יונה הנביא 2 אשדוד</p>
			<div class="map" onclick="runNavigation()">
				<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3390.409546558001!2d34.63895917617039!3d31.813838232583414!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1502a3a074cb73cb%3A0x8500d0e5ae6a25de!2z15DXlNeV15HXqiDXlNeh16TXnw!5e0!3m2!1sen!2sil!4v1685092426865!5m2!1sen!2sil" width="800" height="600" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
			</div>
		</div>
	<div id="loader">
		<div class="innerLoader">
			<lord-icon
				src="https://cdn.lordicon.com/ulhdumaq.json"
				trigger="loop"
				colors="primary:#f4c89c,secondary:#08a88a"
				style="width:250px;height:250px">
			</lord-icon>
		</div>
	</div>
</div>
	<script>
		  	const queryString = window.location.search;
			const urlParams = new URLSearchParams(queryString);
			const name = urlParams.get('name');
			const phone = urlParams.get('phone');
			let spinner = $('#loader');
			$('#name').html(name || 'לך');
			// const form = $('#invitation');
			$("form").submit(function (e) {
				e.preventDefault();
				spinner.show();
				let btn = $(this).find("button[type=submit]:focus" );
				let btnName = btn.attr('name');
				if( btnName.valueOf() === 'coming'){
					isComing = true;
				} else {
					isComing = false;
				}
				sendData()
			});
			function sendData() {
				const amount = $('#amount').val();
				console.log(amount);
				let attendenceName = name;
				const payload = {name:attendenceName , amount: amount, phone:phone , isComming: isComing }
				console.log(payload);
				if (phone && amount !== '0' && name) {
					executeRequest(payload);
				} else{
					$('#amount').focus();
					spinner.hide();
					console.log('something is missing');
				}
			}

			function executeRequest(payload) {
				fetch("https://vivacious-tweed-jacket-jay.cyclic.app/newArrival", {
					method: "POST",
					body: JSON.stringify(payload),
					headers: {
						"Content-type": "application/json; charset=UTF-8"
					}
					}).then((res)=> {
						window.location.replace(`/thanku.html?is=${isComing}`);
						console.log(res);
						spinner.hide();
					}).catch((err) => {
						console.log(err);
						spinner.hide();
					});
			}

			function runNavigation() {
				console.log('erst');
				window.location.assign('https://waze.com/ul?ll=31.814016013784585,34.641587740697325&navigate=yes')
			}

			
	</script>
</body>
</html>
